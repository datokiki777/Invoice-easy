<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>D-BUILDER Invoice</title>
    <link rel="stylesheet" href="style.css">
</head>
<body onload="loadAllData()">

    <div class="header">
        <div class="logo-box">
            <div class="db-logo">
                <svg width="90" height="90" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <rect x="2" y="2" width="96" height="96" rx="18" fill="rgba(255,255,255,0.15)"/>
                    <rect x="6" y="6" width="88" height="88" rx="15" fill="#0d3d7a"/>
                    <path d="M25 35 L50 20 L75 35 L50 50 Z" fill="white"/>
                    <path d="M25 50 L50 65 L75 50 L50 35 Z" fill="rgba(255,255,255,0.7)"/>
                    <path d="M25 65 L50 80 L75 65 L50 50 Z" fill="white"/>
                    <circle cx="50" cy="50" r="6" fill="#0d3d7a"/>
                </svg>
            </div>
            <div class="company-details">
                <input type="text" id="my_comp_name" oninput="saveAllData()" value="D-BUILDER SIA">
                <input type="text" id="my_reg_no" oninput="saveAllData()" value="Reg No: 40203480659">
                <input type="text" id="my_addr" oninput="saveAllData()" value="Address: Mirdzas Ä¶empes iela 11-34, RÄ«ga, LV-1014">
                <input type="text" id="my_phone" oninput="saveAllData()" value="Tel: +371 28601141">
                <input type="text" id="my_email" oninput="saveAllData()" value="Email: dbuilder.team@gmail.com">
            </div>
        </div>
        <h1 class="invoice-title-large">INVOICE</h1>
    </div>

    <div class="meta-section">
        <div>
            <div class="info-label">Billed To:</div>
            <textarea id="client_info" rows="3" oninput="saveAllData()" placeholder="Client details..."></textarea>
        </div>
        <div>
            <div class="info-label">Invoice Details:</div>
            <div class="meta-row">
                <span>Invoice #</span>
                <input type="text" id="inv_num" oninput="saveAllData()" value="">
            </div>
            <div class="meta-row">
                <span>Date</span>
                <input type="text" id="inv_date" oninput="saveAllData()" value="">
            </div>
        </div>
    </div>

   <table>
    <thead>
        <tr>
            <th style="width: 60%;">Description</th>
            <th style="width: 15%; text-align: center;">Qty</th>
            <th style="width: 25%; text-align: right;">Amount</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td class="desc-cell"><input type="text" id="service_desc1" oninput="saveAllData()" value="01/02 - 22/02 installation cost"></td>
            <td class="qty-cell"><input type="number" id="qty1" value="5" class="qty-input" oninput="calculateAll()" min="0" step="0.01"></td>
            <td class="price-cell">
                <div class="price-container">
                    <span class="euro-symbol">â‚¬</span>
                    <input type="number" id="price1" value="500.00" class="num-input" oninput="calculateAll()" min="0" step="0.01">
                </div>
            </td>
        </tr>
        <tr>
            <td class="desc-cell"><input type="text" id="service_desc2" oninput="saveAllData()" value="" placeholder="Additional work..."></td>
            <td class="qty-cell"><input type="number" id="qty2" value="0" class="qty-input" oninput="calculateAll()" min="0" step="0.01"></td>
            <td class="price-cell">
                <div class="price-container">
                    <span class="euro-symbol">â‚¬</span>
                    <input type="number" id="price2" value="0.00" class="num-input" oninput="calculateAll()" min="0" step="0.01">
                </div>
            </td>
        </tr>
    </tbody>
</table>

   <div class="summary-wrapper">
    <div class="summary-table">
        <div class="summary-row">
            <span class="vat-box">
                VAT (
                <input type="number" id="vat_rate" value="19" class="vat-input" oninput="calculateAll()" min="0" max="100" step="0.1">
                %)
                <input type="text" id="vat_text" class="vat-text-input" placeholder="" oninput="calculateAll()" value="">
            </span>
            <span>â‚¬<span id="vat_amount">0.00</span></span>
        </div>
        <div class="total-box">
            <div class="total-row">
                <span>TOTAL</span>
                <span>â‚¬<span id="grand_total">0.00</span></span>
            </div>
        </div>
    </div>
</div>

    <div class="footer-grid">
        <div>
            <div class="footer-title">Bank Details</div>
            <div class="bank-info-box">
                <strong>Recipient:</strong> <input type="text" id="bank_recip" oninput="saveAllData()" value="D-BUILDER SIA"><br>
                <strong>Bank:</strong> <input type="text" id="bank_name" oninput="saveAllData()" value="Revolut Bank UAB"><br>
                <strong>IBAN:</strong> <input type="text" id="bank_iban" oninput="saveAllData()" value="LT68 3250 0118 6894 4162"><br>
                <strong>BIC:</strong> <input type="text" id="bank_bic" oninput="saveAllData()" value="REVOLT21">
            </div>
        </div>
        <div>
            <div class="footer-title">Terms</div>
            <p>Payment due within 7 days. Thank you for your business!</p>
        </div>
    </div>

    <div class="status-bar no-print">
        <span>ğŸ’¾ áƒáƒ•áƒ¢áƒáƒ›áƒáƒ¢áƒ£áƒ áƒ˜ áƒ¨áƒ”áƒœáƒáƒ®áƒ•áƒ</span>
        <span>ğŸ“… áƒ“áƒ¦áƒ”áƒ•áƒáƒœáƒ“áƒ”áƒšáƒ˜ áƒ—áƒáƒ áƒ˜áƒ¦áƒ˜: <span id="today_status"></span></span>
    </div>

    <div class="no-print buttons">
        <button onclick="window.print()">ğŸ“¥ Download PDF</button>
        <button class="new-invoice-btn" onclick="newInvoice()">â• áƒáƒ®áƒáƒšáƒ˜</button>
        <button class="reset-btn" onclick="clearEverything()">ğŸ”„ Reset</button>
    </div>

    <script>
 function saveAllData() {
    const fields = [
        'my_comp_name', 'my_reg_no', 'my_addr', 'my_phone', 'my_email',
        'client_info', 'inv_num', 'inv_date', 
        'service_desc1', 'qty1', 'price1',
        'service_desc2', 'qty2', 'price2',
        'vat_rate', 'vat_text', 'bank_recip', 'bank_name', 'bank_iban', 'bank_bic'
    ];
    const data = {};
    fields.forEach(id => { 
        const el = document.getElementById(id); 
        if (el) data[id] = el.value; 
    });
    localStorage.setItem('db_invoice_data', JSON.stringify(data));
}

function loadAllData() {
    const saved = localStorage.getItem('db_invoice_data');
    
    if (saved) {
        const data = JSON.parse(saved);
        for (let id in data) { 
            if (document.getElementById(id)) {
                document.getElementById(id).value = data[id];
            }
        }
    }
    
    document.getElementById('inv_date').value = getCurrentDate();
    document.getElementById('inv_num').value = generateInvoiceNumber();
    document.getElementById('today_status').innerText = getCurrentDate();
    
    calculateAll();
}

function calculateAll() {
    // áƒáƒ˜áƒ áƒ•áƒ”áƒšáƒ˜ áƒ®áƒáƒ–áƒ˜
    let qty1 = parseFloat(document.getElementById('qty1').value) || 0;
    let price1 = parseFloat(document.getElementById('price1').value) || 0;
    let subtotal1 = qty1 * price1;
    
    // áƒ›áƒ”áƒáƒ áƒ” áƒ®áƒáƒ–áƒ˜
    let qty2 = parseFloat(document.getElementById('qty2').value) || 0;
    let price2 = parseFloat(document.getElementById('price2').value) || 0;
    let subtotal2 = qty2 * price2;
    
    // áƒ›áƒ—áƒšáƒ˜áƒáƒœáƒ˜ áƒ—áƒáƒœáƒ®áƒ
    let subtotal = subtotal1 + subtotal2;
    
    let vatRate = parseFloat(document.getElementById('vat_rate').value) || 0;
    let vatValue = subtotal * (vatRate / 100);
    let total = subtotal + vatValue;

    document.getElementById('vat_amount').innerText = vatValue.toFixed(2);
    document.getElementById('grand_total').innerText = total.toFixed(2);
    
    // VAT áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜áƒ¡ áƒ•áƒ”áƒšáƒ˜áƒ¡ áƒ¨áƒ”áƒœáƒáƒ®áƒ•áƒ
    saveAllData();
}

function generateInvoiceNumber() {
    const saved = localStorage.getItem('db_invoice_data');
    const currentYear = new Date().getFullYear();
    
    if (saved) {
        const data = JSON.parse(saved);
        const lastNum = data.inv_num;
        if (lastNum) {
            const parts = lastNum.split('-');
            if (parts.length === 2 && parts[0] == currentYear) {
                const nextNum = parseInt(parts[1]) + 1;
                return `${currentYear}-${nextNum.toString().padStart(3, '0')}`;
            }
        }
    }
    return `${currentYear}-001`;
}

function getCurrentDate() {
    const today = new Date();
    const day = today.getDate().toString().padStart(2, '0');
    const month = (today.getMonth() + 1).toString().padStart(2, '0');
    const year = today.getFullYear();
    return `${day}/${month}/${year}`;
}

        function newInvoice() {
            if(confirm("áƒ¨áƒ”áƒ•áƒ¥áƒ›áƒœáƒáƒ— áƒáƒ®áƒáƒšáƒ˜ áƒ˜áƒœáƒ•áƒáƒ˜áƒ¡áƒ˜?")) {
                document.getElementById('inv_num').value = generateInvoiceNumber();
                document.getElementById('inv_date').value = getCurrentDate();
                document.getElementById('client_info').value = '';
                document.getElementById('service_desc1').value = '';
                document.getElementById('qty1').value = '1';
                document.getElementById('price1').value = '0.00';
                document.getElementById('service_desc2').value = '';
                document.getElementById('qty2').value = '0';
                document.getElementById('price2').value = '0.00';
                document.getElementById('vat_rate').value = '0';
                document.getElementById('vat_text').value = '';
                saveAllData();
                calculateAll();
            }
        }

        function clearEverything() { 
            if(confirm("áƒ’áƒáƒ¡áƒ£áƒ¤áƒ—áƒáƒ•áƒ”áƒ‘áƒ?")) { 
                localStorage.removeItem('db_invoice_data'); 
                location.reload(); 
            } 
        }
    </script>

</body>
</html>