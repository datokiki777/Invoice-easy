<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>D-BUILDER Invoice</title>
    
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; max-width: 850px; margin: auto; padding: 20px; color: #333; line-height: 1.4; background-color: #fff; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
        .logo-box { display: flex; align-items: center; gap: 20px; }
        .db-logo { width: 90px; height: 90px; flex-shrink: 0; }
        .company-details { display: flex; flex-direction: column; gap: 2px; }
        .company-details input { display: block; width: 100%; border: none; background: transparent; font-family: inherit; color: #666; font-size: 13px; padding: 0; margin: 0; }
        #my_comp_name { font-size: 24px; color: #0d3d7a; font-weight: bold; margin-bottom: 5px; }
        .invoice-title-large { color: #0d3d7a; font-size: clamp(30px, 8vw, 60px); font-weight: 900; margin: 0; letter-spacing: 4px; }
        .meta-section { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; border-top: 3px solid #0d3d7a; padding-top: 20px; margin-bottom: 30px; }
        .info-label { font-weight: bold; color: #0d3d7a; margin-bottom: 8px; font-size: 14px; text-transform: uppercase; }
        .meta-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; border-bottom: 1px solid #f0f0f0; white-space: nowrap; }
        
        textarea, input { border: 1px solid #eee; padding: 6px; font-size: 14px; width: 100%; border-radius: 3px; font-family: inherit; background: transparent; box-sizing: border-box; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background-color: #0d3d7a !important; color: white !important; padding: 12px; text-align: left; -webkit-print-color-adjust: exact; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        .num-input { text-align: right; width: 120px; font-weight: bold; border: none; font-size: 15px; }
        .summary-wrapper { display: flex; justify-content: flex-end; margin-top: 20px; }
        .summary-table { width: 100%; max-width: 300px; }
        .summary-row { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; font-weight: bold; }
        .total-box { background: #0d3d7a !important; color: white !important; padding: 15px; font-weight: bold; font-size: 22px; margin-top: 10px; border-radius: 4px; -webkit-print-color-adjust: exact; }
        
        .footer-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 50px; }
        .footer-title { font-weight: bold; color: #0d3d7a; border-bottom: 1px solid #ddd; padding-bottom: 5px; margin-bottom: 10px; text-transform: uppercase; }
        .bank-info-box { background: #f9f9f9; padding: 15px; border-radius: 4px; border-left: 4px solid #0d3d7a; font-size: 13px; }
        .bank-info-box input { border: none; font-weight: bold; width: auto; }
        
        /* ქვედა უჯრები */
        .extra-fields-section { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 40px; padding-top: 20px; border-top: 1px dashed #ddd; }
        .extra-field-box textarea { border: 1px solid #f0f0f0; resize: none; font-size: 13px; color: #555; height: 50px; }

        .no-print { text-align: center; margin-top: 50px; display: flex; justify-content: center; gap: 10px; }
        button { background: #0d3d7a; color: white; border: none; padding: 15px 30px; cursor: pointer; border-radius: 5px; font-weight: bold; }
        .reset-btn { background: #d9534f; }

        /* ბეჭდვის ლოგიკა */
        @media print { 
            .no-print { display: none !important; } 
            body { padding: 0; }
            textarea, input { border: none !important; }
            /* თუ ცარიელია, არ გამოჩნდეს ბეჭდვისას */
            .hide-if-empty:placeholder-shown { display: none !important; }
            .extra-fields-section:has(textarea:placeholder-shown:only-child) { border: none !important; }
        }
    </style>
</head>
<body onload="loadAllData()">

    <div class="header">
        <div class="logo-box">
            <div class="db-logo">
                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <rect x="5" y="5" width="90" height="90" rx="15" fill="#0d3d7a"/>
                    <path d="M25 35 L50 20 L75 35 L50 50 Z" fill="white"/>
                    <path d="M25 50 L50 65 L75 50 L50 35 Z" fill="rgba(255,255,255,0.7)"/>
                    <path d="M25 65 L50 80 L75 65 L50 50 Z" fill="white"/>
                    <circle cx="50" cy="50" r="6" fill="#0d3d7a"/>
                </svg>
            </div>
            <div class="company-details">
                <input type="text" id="my_comp_name" oninput="saveAllData()" value="D-BUILDER SIA">
                <input type="text" id="my_reg_no" oninput="saveAllData()" value="Reg No: 40203480659">
                <input type="text" id="my_addr" oninput="saveAllData()" value="Address: Mirdzas Ķempes iela 11-34, Rīga, LV-1014">
                <input type="text" id="my_phone" oninput="saveAllData()" value="Tel: +371 28601141">
                <input type="text" id="my_email" oninput="saveAllData()" value="Email: dbuilder.team@gmail.com">
            </div>
        </div>
        <h1 class="invoice-title-large">INVOICE</h1>
    </div>

    <div class="meta-section">
        <div>
            <div class="info-label">Billed To:</div>
            <textarea id="client_info" rows="4" oninput="saveAllData()" placeholder="Client details..."></textarea>
        </div>
        <div>
            <div class="info-label">Invoice Details:</div>
            <div class="meta-row">
                <span>Invoice #</span>
                <input type="text" id="inv_num" oninput="saveAllData()" value="2026-001" style="text-align: right; border:none; width: 100%;">
            </div>
            <div class="meta-row" style="border-bottom: none;">
                <span>Date</span>
                <input type="text" id="inv_date" oninput="saveAllData()" value="24/02/2026" style="text-align: right; border:none; width: 100%;">
            </div>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th style="width: 70%;">Description</th>
                <th style="text-align: right; width: 30%;">Amount</th>
            </tr>
        </thead>
        <tbody id="invoice-items">
            <tr>
                <td><input type="text" id="service_desc1" oninput="saveAllData()" value="Installation costs" style="border:none;"></td>
                <td style="text-align: right;">€ <input type="number" id="price1" value="0.00" class="num-input" oninput="calculateAll()"></td>
            </tr>
        </tbody>
    </table>

    <div class="summary-wrapper">
        <div class="summary-table">
            <div class="summary-row">
                <span>VAT (<input type="number" id="vat_rate" value="0" oninput="calculateAll()" style="width: 40px; text-align: center; border: none; font-weight: bold;">%)</span>
                <span>€ <span id="vat_amount">0.00</span></span>
            </div>
            <div class="total-box">
                <div style="display: flex; justify-content: space-between;">
                    <span>TOTAL</span>
                    <span>€ <span id="grand_total">0.00</span></span>
                </div>
            </div>
        </div>
    </div>

    <div class="footer-grid">
        <div>
            <div class="footer-title">Bank Details</div>
            <div class="bank-info-box">
                <strong>Recipient:</strong> <input type="text" id="bank_recip" oninput="saveAllData()" value="D-BUILDER SIA"><br>
                <strong>Bank:</strong> <input type="text" id="bank_name" oninput="saveAllData()" value="Revolut Bank UAB"><br>
                <strong>IBAN:</strong> <input type="text" id="bank_iban" oninput="saveAllData()" value="LT68 3250 0118 6894 4162"><br>
                <strong>BIC:</strong> <input type="text" id="bank_bic" oninput="saveAllData()" value="REVOLT21">
            </div>
        </div>
        <div>
            <div class="footer-title">Terms</div>
            <p style="font-size: 14px; margin: 0;">Payment due within 7 days. Thank you for your business!</p>
        </div>
    </div>

    <div class="extra-fields-section" id="extra-section">
        <div class="extra-field-box">
            <textarea id="extra_note_left" class="hide-if-empty" oninput="saveAllData()" placeholder=" "></textarea>
        </div>
        <div class="extra-field-box">
            <textarea id="extra_note_right" class="hide-if-empty" oninput="saveAllData()" placeholder=" "></textarea>
        </div>
    </div>

    <div class="no-print">
        <button onclick="window.print()">Download PDF / Print</button>
        <button class="reset-btn" onclick="clearEverything()">Reset</button>
    </div>

    <script>
        function saveAllData() {
            const fields = [
                'my_comp_name', 'my_reg_no', 'my_addr', 'my_phone', 'my_email', 
                'client_info', 'inv_num', 'inv_date', 'service_desc1', 
                'price1', 'vat_rate', 'bank_recip', 'bank_name', 'bank_iban', 
                'bank_bic', 'extra_note_left', 'extra_note_right'
            ];
            const data = {};
            fields.forEach(id => { const el = document.getElementById(id); if(el) data[id] = el.value; });
            localStorage.setItem('db_invoice_vfinal_clean', JSON.stringify(data));
        }

        function loadAllData() {
            const saved = localStorage.getItem('db_invoice_vfinal_clean');
            if (saved) {
                const data = JSON.parse(saved);
                for (let id in data) { if (document.getElementById(id)) document.getElementById(id).value = data[id]; }
            }
            calculateAll();
        }

        function calculateAll() {
            let p1 = parseFloat(document.getElementById('price1').value) || 0;
            let subtotal = p1;
            let vatRate = parseFloat(document.getElementById('vat_rate').value) || 0;
            let vatValue = subtotal * (vatRate / 100);
            let total = subtotal + vatValue;

            document.getElementById('vat_amount').innerText = vatValue.toFixed(2);
            document.getElementById('grand_total').innerText = total.toLocaleString('en-US', {minimumFractionDigits: 2});
            saveAllData();
        }

        function clearEverything() { if(confirm("Clear all data?")) { localStorage.removeItem('db_invoice_vfinal_clean'); location.reload(); } }
    </script>

</body>
</html>
